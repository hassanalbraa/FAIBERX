{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a clothing item available for purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "images": {
          "type": "array",
          "description": "Array of image URLs for the product.",
          "items": {
            "type": "string"
          }
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., shirts, pants, dresses)."
        },
        "availableSizes": {
          "type": "array",
          "description": "Array of available sizes for the product.",
          "items": {
            "type": "string"
          }
        },
        "availableColors": {
          "type": "array",
          "description": "Array of available colors for the product.",
          "items": {
            "type": "string"
          }
        },
        "stockQuantity": {
          "type": "number",
          "description": "The number of items currently in stock."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the product was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the product was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "images",
        "price",
        "category",
        "availableSizes",
        "availableColors",
        "stockQuantity"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user who can manage products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "username": {
          "type": "string",
          "description": "Username for the admin user."
        },
        "email": {
          "type": "string",
          "description": "Email address for the admin user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the admin user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the admin user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a regular user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Firebase UID)."
        },
        "email": {
          "type": "string",
          "description": "Email address for the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Only admins can create, update, or delete products. All users have read-only access.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Collection indicating admin users. The existence of a document here grants admin privileges.",
          "params": [
            {
              "name": "adminId",
              "description": "The Firebase UID of the administrator."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores public profile information for a user. Each user can only write to their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the Threads of Couture application, focusing on product management by administrators and user-specific data. The key principle is Authorization Independence, achieved by avoiding `get()` calls in security rules through structural segregation and explicit role definitions. Products are stored in a top-level `/products` collection, and admin users are managed via the `/roles_admin/{uid}` collection. Regular user data is stored in `/users/{uid}`. The existence of a document in `/roles_admin/{uid}` grants administrative privileges.\n\n**Authorization Independence:** Authorization is determined by checking document ownership (`request.auth.uid == userId`) for user data, or checking the existence of a document in the `/roles_admin/{uid}` collection for admin privileges. This eliminates hierarchical authorization dependencies.\n\n**QAPs (Rules Are Not Filters):** List operations on products are public. List operations on users are disallowed by the rules to prevent data leakage.\n\n**Segregation:** The `/products` collection stores product data, the `/roles_admin/{uid}` collection manages admin user roles, and `/users/{uid}` stores individual user data. This separation ensures that security rules are applied correctly and independently for each data type."
  }
}