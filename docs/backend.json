{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a clothing item available for purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "image": {
          "type": "string",
          "description": "Image URL for the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., shirts, pants, dresses)."
        },
        "stock": {
          "type": "number",
          "description": "The number of items currently in stock."
        },
        "sizes": {
            "type": "array",
            "description": "Available sizes for the product.",
            "items": {
                "type": "string"
            }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "image",
        "price",
        "category",
        "stock"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user who can manage products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "username": {
          "type": "string",
          "description": "Username for the admin user."
        },
        "email": {
          "type": "string",
          "description": "Email address for the admin user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the admin user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the admin user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a regular user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Firebase UID)."
        },
        "email": {
          "type": "string",
          "description": "Email address for the user.",
          "format": "email"
        },
        "accountNumber": {
          "type": "string",
          "description": "A unique, customer-facing account number."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "isBanned": {
          "type": "boolean",
          "description": "Indicates if the user is banned from the service."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        },
        "cart": {
          "type": "array",
          "description": "The user's shopping cart items.",
          "items": {
            "type": "object",
            "properties": {
              "productId": {
                "type": "string"
              },
              "quantity": {
                "type": "number"
              },
              "size": {
                "type": "string"
              }
            },
            "required": ["productId", "quantity", "size"]
          }
        }
      },
      "required": [
        "id",
        "email",
        "accountNumber"
      ]
    },
    "Address": {
      "title": "Address",
      "type": "object",
      "description": "Represents a user's saved shipping address.",
      "properties": {
        "firstName": { "type": "string", "description": "Recipient's first name." },
        "lastName": { "type": "string", "description": "Recipient's last name." },
        "address": { "type": "string", "description": "Street address and number." },
        "city": { "type": "string", "description": "City." },
        "country": { "type": "string", "description": "Country." },
        "whatsappNumber": { "type": "string", "description": "WhatsApp contact number." }
      },
      "required": ["firstName", "lastName", "address", "city", "country", "whatsappNumber"]
    },
    "Order": {
      "title": "Order",
      "type": "object",
      "description": "Represents a customer's order.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who placed the order."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": [
            "Order Placed",
            "Processing",
            "Shipped",
            "Out for Delivery",
            "Delivered",
            "Cancelled",
            "Suspended"
          ]
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "productId": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "image": {
                "type": "string"
              },
              "quantity": {
                "type": "number"
              },
              "price": {
                "type": "number"
              },
              "size": {
                  "type": "string"
              }
            }
          }
        },
        "shippingAddress": {
          "type": "object",
          "properties": {
            "email": {
              "type": "string",
              "format": "email"
            },
            "name": {
              "type": "string"
            },
            "address": {
              "type": "string"
            },
            "city": {
              "type": "string"
            },
            "country": {
              "type": "string"
            },
            "whatsappNumber": {
              "type": "string"
            }
          }
        },
        "payment": {
          "type": "object",
          "properties": {
            "method": {
              "type": "string"
            },
            "transactionId": {
              "type": "string"
            }
          }
        },
        "subTotal": {
          "type": "number"
        },
        "shippingCost": {
          "type": "number"
        },
        "total": {
          "type": "number"
        }
      },
      "required": [
        "userId",
        "createdAt",
        "status",
        "items",
        "shippingAddress",
        "payment",
        "total"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Only admins can create, update, or delete products. All users have read-only access.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Collection indicating admin users. The existence of a document here grants admin privileges.",
          "params": [
            {
              "name": "adminId",
              "description": "The Firebase UID of the administrator."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores public profile information for a user. Each user can only write to their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/addresses/{addressId}",
        "definition": {
          "entityName": "Address",
          "schema": {
            "$ref": "#/backend/entities/Address"
          },
          "description": "Stores a user's saved shipping addresses. Users can only manage their own addresses.",
          "params": [
            { "name": "userId", "description": "The UID of the user." },
            { "name": "addressId", "description": "The unique ID for the address." }
          ]
        }
      },
      {
        "path": "/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer order information. Users can read their own orders. Admins can read and update all orders.",
          "params": [
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the Threads of Couture application, focusing on product management by administrators and user-specific data. The key principle is Authorization Independence, achieved by avoiding `get()` calls in security rules through structural segregation and explicit role definitions. Products are stored in a top-level `/products` collection, and admin users are managed via the `/roles_admin/{uid}` collection. Regular user data is stored in `/users/{uid}`. The existence of a document in `/roles_admin/{uid}` grants administrative privileges.\n\n**Authorization Independence:** Authorization is determined by checking document ownership (`request.auth.uid == userId`) for user data, or checking the existence of a document in the `/roles_admin/{uid}` collection for admin privileges. This eliminates hierarchical authorization dependencies.\n\n**QAPs (Rules Are Not Filters):** List operations on products are public. Admins are allowed to list users for management purposes, but regular users cannot list other users.\n\n**Segregation:** The `/products` collection stores product data, the `/roles_admin/{uid}` collection manages admin user roles, and `/users/{uid}` stores individual user data. This separation ensures that security rules are applied correctly and independently for each data type."
  }
}
