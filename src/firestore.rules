rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±
    function isAdmin() {
      return request.auth != null && request.auth.uid == "5Kp5lbgb8fOJSr0OS5p1J4MMg2q1";
    }

    /* =========================
       ğŸ›ï¸ PRODUCTS
       ========================= */
    match /products/{productId} {
      allow read: if true; // Ø£ÙŠ Ø²ÙˆÙ„ ÙŠÙ‚Ø¯Ø± ÙŠÙ‚Ø±Ø§ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
      allow write: if isAdmin(); // Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø· ÙŠÙ‚Ø¯Ø± ÙŠØ¶ÙŠÙ/ÙŠØ¹Ø¯Ù„
    }

    /* =========================
       ğŸ‘¤ USERS & SUB-COLLECTIONS
       ========================= */
    match /users/{userId} {
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
      allow write: if request.auth != null && request.auth.uid == userId;

      // Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø£Ø¯Ù…Ù† Ø¨Ø±Ø¤ÙŠØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª ÙØ±Ø¹ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      match /orders/{orderId} {
        allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
        allow write: if request.auth != null && request.auth.uid == userId;
      }
    }

    /* =========================
       ğŸ§¾ ORDERS (Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
       ========================= */
    match /orders/{orderId} {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…ØªØ§Ø­ Ù„Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
      allow create: if request.auth != null;
      
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØ§Ø­Ø© Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ù„Ù„Ø£Ø¯Ù…Ù†
      allow read: if isAdmin() || (request.auth != null && resource.data.userId == request.auth.uid);
      
      // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
      allow update, delete: if isAdmin();
    }

    /* =========================
       ğŸ“¢ Ø§Ù„Ù€ Indexing
       ========================= */
    // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø¯ÙˆÙ† orderBy Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯
  }
}
